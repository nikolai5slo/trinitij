function AsteroidNest(e,t,o){var i=new BABYLON.Vector3(0,0,-t),r=BABYLON.Mesh.CreateBox("bBox",e,o);r.target=null;var a=r.getBoundingInfo().boundingBox.vectorsWorld[0],n=r.getBoundingInfo().boundingBox.vectorsWorld[1],s=new BABYLON.Mesh.CreateBox("fountain",.1,o);s.visibility=0;var l=new BABYLON.ParticleSystem("particles",3e4,o);s.position.y=0,s.position.x=0,s.position.z=0,l.particleTexture=new BABYLON.Texture("textures/flare.png",o),l.emitRate=1e3,l.emitter=s,l.minEmitBox=a.multiplyByFloats(.3,.3,.5),l.maxEmitBox=n.multiplyByFloats(.3,.3,1),l.minSize=.3,l.maxSize=1,l.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,l.textureMask=new BABYLON.Color4(1,1,1,1),l.color1=new BABYLON.Color4(1,.4,0,0),l.color2=new BABYLON.Color4(0,0,0,0),l.colorDead=new BABYLON.Color4(1,1,1,1),l.maxLifeTime=50,l.gravity=i.scale(.5),l.direction1=new BABYLON.Vector3(-1,-1,-1),l.direction2=new BABYLON.Vector3(1,1,1),l.minAngularSpeed=0,l.maxAngularSpeed=Math.PI,l.minEmitPower=1,l.maxEmitPower=1,l.updateSpeed=.1,l.start();var c="http://jerome.bousquie.fr/BJS/images/rock.jpg",m=new BABYLON.StandardMaterial("mat1",o),d=new BABYLON.Texture(c,o);m.diffuseTexture=d,m.backFaceCulling=!1;var p=0,u=0,B=0,h=0,x=function(e,t,o){t.x*=Math.random()+1,t.y*=Math.random()+1,t.z*=Math.random()+1},y=new BABYLON.SolidParticleSystem("SPS",o,{updatable:!1}),N=BABYLON.MeshBuilder.CreateSphere("s",{diameter:6,segments:3},o);y.addShape(N,500,{vertexFunction:x});var g=y.buildMesh();return g.position.z=0,g.material=m,N.dispose(),y.initParticles=function(){for(var e=0;e<this.nbParticles;e++)this.recycleParticle(this.particles[e]),this.particles[e].position.x=randomNumber(a.x,n.x),this.particles[e].position.y=randomNumber(a.y,n.y),this.particles[e].position.z=randomNumber(a.z,n.z)},y.recycleParticle=function(e){p=Math.random()/2+.1,u=Math.random()/2+.1,B=Math.random()/2+.1,e.scale.x=p,e.scale.y=u,e.scale.z=B,e.position.x=randomNumber(a.x,n.x),e.position.y=randomNumber(a.y,n.y),e.position.z=n.z-10,e.rotation.x=3.5*Math.random(),e.rotation.y=3.5*Math.random(),e.rotation.z=3.5*Math.random(),h=1-.3*Math.random(),e.color=new BABYLON.Color4(h,h,h,1),e.velocity=i},y.updateParticle=function(e){r.intersectsPoint(e.position)||this.recycleParticle(e),e.position.addInPlace(e.velocity);var t=e.idx%2==0?1:-1;e.rotation.z+=.009*t,e.rotation.x+=.003*t,e.rotation.y+=.002*t},y.initParticles(),y.setParticles(),y.refreshVisibleSize(),y.computeParticleVertex=!1,y.computeParticleColor=!1,y.computeParticleTexture=!1,o.registerBeforeRender(function(){y.setParticles(),y.refreshVisibleSize(),y.computeParticleVertex=!1}),r.asteroids=[],asteroidMaterial=null,BABYLON.SceneLoader.ImportMesh("Asteroid","obj/","asteroid1.babylon",o,function(e,t){for(var i=0;300>i;i++){var s=e[0].createInstance("i"+i);r.asteroids.push(s),s.scaling.x*=30+100*Math.random(),s.scaling.y*=30+100*Math.random(),s.scaling.z*=30+100*Math.random(),s.position.x=randomNumber(a.x,n.x),s.position.y=randomNumber(a.y,n.y),s.position.z=randomNumber(a.z,n.z),null==asteroidMaterial?(s.material.specularTexture=new BABYLON.Texture("obj/astbump.jpg",o),s.material.specularPower=2,asteroidMaterial=s.material):s.material=asteroidMaterial,s.setPhysicsState({impostor:BABYLON.PhysicsEngine.SphereImpostor,move:!0,mass:1,friction:.5,restitution:.5}),s.applyImpulse(new BABYLON.Vector3(10*Math.random()-5,10*Math.random()-5,20*Math.random()+5),s.position)}}),o.registerBeforeRender(function(){null!=r.target&&void 0!=r.target.ship&&(s.position=r.position=r.target.ship.position,a=r.getBoundingInfo().boundingBox.vectorsWorld[0],n=r.getBoundingInfo().boundingBox.vectorsWorld[1]),r.asteroids.forEach(function(e){e.applyImpulse(i,e.position),r.intersectsPoint(e.position)||(e.setPhysicsState(BABYLON.PhysicsEngine.NoImpostor),e.position.z=n.z-10,e.position.x=randomNumber(a.x,n.x),e.position.y=randomNumber(a.y,n.y),e.updatePhysicsBodyPosition(),e.refreshBoundingInfo(),e.setPhysicsState({impostor:BABYLON.PhysicsEngine.SphereImpostor,move:!0,mass:1,friction:.5,restitution:.5}))})}),r}